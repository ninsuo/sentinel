{# templates/project/_layout.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}{{ project.name }} · Sentinel{% endblock %}

{% block breadcrumb %}
    {% include '_partials/_breadcrumb.html.twig' with {
        items: [
            { label: project.name, url: path('app_project_show', {id: project.id}) }
        ] | merge(breadcrumb_items ?? [])
    } only %}
{% endblock %}

{% block body %}
    <div class="row g-3">
        <aside class="col-12 col-lg-3">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="fw-semibold mb-2">{{ project.name }}</div>
                    <div class="text-secondary small text-break">{{ project.path }}</div>
                </div>

                {#
                expected vars:
                - project (Project)
                - active_menu (string)
                - active_feature_id (int|null) optional, for highlight
                #}
                {% set active_menu = active_menu ?? '' %}
                {% set active_feature_id = active_feature_id ?? null %}

                <div class="list-group list-group-flush">

                    <a class="list-group-item list-group-item-action {{ active_menu == 'project_home' ? 'active' : '' }}"
                       href="{{ path('app_project_show', {id: project.id}) }}">
                        Project home
                    </a>

                    <a class="list-group-item list-group-item-action {{ active_menu == 'project_config' ? 'active' : '' }}"
                       href="{{ path('app_project_edit', {id: project.id}) }}">
                        Configuration
                    </a>

                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span class="text-uppercase small text-secondary fw-semibold mb-0">Features</span>
                        <a class="btn btn-sm btn-outline-primary"
                           href="{{ path('app_feature_new', {id: project.id}) }}">
                            +
                        </a>
                    </div>

                    {# Feature list (from inverse side) #}
                    {% set features = project.features|default([]) %}

                    {% if features is empty %}
                        <div class="list-group-item text-secondary small">
                            No features yet.
                        </div>
                    {% else %}
                        {% for feature in features %}
                            {# hide deleted features if you keep soft-delete #}
                            {% if feature.deletedAt is not null %}
                            {% else %}
                                <a class="list-group-item list-group-item-action py-2
                          {{ active_feature_id == feature.id ? 'active' : '' }}"
                                   href="{{ path('app_feature_show', {projectId: project.id, featureId: feature.id}) }}">
                                    <div class="small fw-semibold text-break">{{ feature.name }}</div>
                                    {#                                    <div class="small text-secondary text-break"> #}
                                    {#                                        #{{ feature.id }} #}
                                    {#                                    </div> #}
                                </a>
                            {% endif %}
                        {% endfor %}
                    {% endif %}

                    <div class="list-group-item">
                        <a class="link-secondary text-decoration-none" href="{{ path('app_home') }}">
                            ← All projects
                        </a>
                    </div>
                </div>

            </div>
        </aside>

        <section class="col-12 col-lg-9">
            {% block project_content %}{% endblock %}
        </section>
    </div>
{% endblock %}
